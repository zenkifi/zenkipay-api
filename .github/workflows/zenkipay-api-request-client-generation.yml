# This GitHub Actions workflow was auto-generated by the `rdme` cli on 2022-11-17T02:26:44.324Z
# You can view our full documentation here: https://docs.readme.com/docs/rdme
name: SDKs request generation

on:
  push:
    branches:
      # This workflow will run every time you push code to the following branch: `main`
      # Check out GitHub's docs for more info on configuring this:
      # https://docs.github.com/actions/using-workflows/events-that-trigger-workflows
      - 'main'
    paths:
      - 'CHANGELOG.md'
      - '.github/workflows/zenkipay-api-request-client-generation.yml'

jobs:
  build:
    runs-on: ubuntu-latest
    env:
      PreviousVersion:
      NewVersion:
    steps:
      - name: Checkout local repository zenkipay-api
        uses: actions/checkout@v3

      - name: Moviendo para descargar el repositorio orquestador de clientes
        run: |
          pwd
          ls -la
          cd ..

      - name: Checkout repository zenkipay-api-clients-sdk
        uses: actions/checkout@v3
        with:
          repository: zenkifi/zenkipay-api-clients-sdk
          path: zenkipay-api-clients-sdk

      - name: Moviendo para ver el repositorio orquestador de clientes
        run: |
          pwd
          ls -la
          cd zenkipay-api-clients-sdk
          ls -la

      - name: Generando archivo de versionado
        run: |
          pwd
          ls -la
          cd zenkipay-api-clients-sdk
          echo "Version pasada"
          cat ZenkipayApiLastVersion.txt
          set /p PreviousVersion=<ZenkipayApiLastVersion.txt
          echo $PreviousVersion
          echo "Version nueva"
          rm ZenkipayApiLastVersion.txt
          cat ../CHANGELOG.md | grep "Zenkipay API specification last version:" | awk '{print $6}' > ZenkipayApiLastVersion.txt
          cat ZenkipayApiLastVersion.txt
          echo $PreviousVersion
          echo $PreviousVersion >> $GITHUB_ENV
          NewVersion=$(cat ZenkipayApiLastVersion.txt)
          echo $NewVersion
          echo $NewVersion >> $GITHUB_ENV
          ls -la

      - name: Subiendo versionado para iniciar construcción de librerías de SDKs
        run: |
          echo $PreviousVersion
          echo $NewVersion
          echo "${{ env.PreviousVersion }}"
          echo "${{ env.NewVersion }}"
          if [ "$PreviousVersion" = "$NewVersion" ]; then
            echo "No ha habido cambios en la versión"
          else
            echo "Hay una nueva versión, se mandara a generar clientes."
            cd zenkipay-api-clients-sdk
            git config user.name github-actions
            git config user.email github-actions@github.com
            git add ZenkipayApiLastVersion.txt
            git commit -m "Se solicita la generación y actualización de los SDK's"
            git push
          fi
